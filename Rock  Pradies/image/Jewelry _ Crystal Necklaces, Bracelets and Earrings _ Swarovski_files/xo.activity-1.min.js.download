var xo=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t){return e(t={exports:{}},t.exports),t.exports}var i=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Post="POST",e.Get="GET",e.Put="PUT",e.Patch="PATCH",e.Delete="DELETE"}(t.Method||(t.Method={}))}));r(i);i.Method;var s=a((function(e,r){var a,i=t&&t.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(e){function t(r){var a=e.call(this,r)||this;return a.name="TimeoutError",Object.setPrototypeOf(a,t.prototype),a}return i(t,e),t}(Error);r.TimeoutError=s}));r(s);s.TimeoutError;var n=a((function(e,t){function r(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s)}));r(n);var o=a((function(e,r){var a=t&&t.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(i,s){function n(e){try{p(a.next(e))}catch(e){s(e)}}function o(e){try{p(a.throw(e))}catch(e){s(e)}}function p(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,o)}p((a=a.apply(e,t||[])).next())}))},i=t&&t.__generator||function(e,t){var r,a,i,s,n={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,a=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(i=n.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(6===s[0]&&n.label<i[1]){n.label=i[1],i=s;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(s);break}i[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],a=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e){this.scope=e}return e.prototype.send=function(e){return a(this,void 0,void 0,(function(){var t,r,a;return i(this,(function(i){switch(i.label){case 0:return(t={method:e.method,headers:e.headers||{},body:e.body,keepalive:e.keepalive,referrerPolicy:e.referrerPolicy||"no-referrer",cache:e.cache}).headers["X-SDK"]="1",[4,Promise.race([this.scope.fetch(e.url,t),Number.isInteger(e.timeout)&&new Promise((function(t,r){setTimeout((function(){return r(new n.TimeoutError)}),e.timeout)}))].filter((function(e){return e instanceof Promise})))];case 1:return r=i.sent(),a={status:r.status},[4,r.text()];case 2:return[2,(a.body=i.sent(),a)]}}))}))},e}();r.BrowserHttpClient=s}));r(o);o.BrowserHttpClient;var p="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),u=new Uint8Array(16);function c(){if(!p)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(u)}for(var d,y,h=[],m=0;m<256;++m)h[m]=(m+256).toString(16).substr(1);function f(e,t){var r=t||0,a=h;return[a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]]].join("")}var l=0,g=0;function v(e,t,r){var a=function(e,a,i,s){var n=i&&s||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)),"string"==typeof a&&(a=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(a)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(a)||16!==a.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var o=r(a.concat(e));if(o[6]=15&o[6]|t,o[8]=63&o[8]|128,i)for(var p=0;p<16;++p)i[n+p]=o[p];return i||f(o)};try{a.name=e}catch(e){}return a.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",a.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",a}function b(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function P(e,t,r,a,i,s){return b((n=b(b(t,e),b(a,s)))<<(o=i)|n>>>32-o,r);var n,o}function w(e,t,r,a,i,s,n){return P(t&r|~t&a,e,t,i,s,n)}function I(e,t,r,a,i,s,n){return P(t&a|r&~a,e,t,i,s,n)}function A(e,t,r,a,i,s,n){return P(t^r^a,e,t,i,s,n)}function k(e,t,r,a,i,s,n){return P(r^(t|~a),e,t,i,s,n)}var _=v("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var r=0;r<t.length;r++)e[r]=t.charCodeAt(r)}return function(e){var t,r,a,i=[],s=32*e.length;for(t=0;t<s;t+=8)r=e[t>>5]>>>t%32&255,a=parseInt("0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r),16),i.push(a);return i}(function(e,t){var r,a,i,s,n;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var o=1732584193,p=-271733879,u=-1732584194,c=271733878;for(r=0;r<e.length;r+=16)a=o,i=p,s=u,n=c,o=w(o,p,u,c,e[r],7,-680876936),c=w(c,o,p,u,e[r+1],12,-389564586),u=w(u,c,o,p,e[r+2],17,606105819),p=w(p,u,c,o,e[r+3],22,-1044525330),o=w(o,p,u,c,e[r+4],7,-176418897),c=w(c,o,p,u,e[r+5],12,1200080426),u=w(u,c,o,p,e[r+6],17,-1473231341),p=w(p,u,c,o,e[r+7],22,-45705983),o=w(o,p,u,c,e[r+8],7,1770035416),c=w(c,o,p,u,e[r+9],12,-1958414417),u=w(u,c,o,p,e[r+10],17,-42063),p=w(p,u,c,o,e[r+11],22,-1990404162),o=w(o,p,u,c,e[r+12],7,1804603682),c=w(c,o,p,u,e[r+13],12,-40341101),u=w(u,c,o,p,e[r+14],17,-1502002290),p=w(p,u,c,o,e[r+15],22,1236535329),o=I(o,p,u,c,e[r+1],5,-165796510),c=I(c,o,p,u,e[r+6],9,-1069501632),u=I(u,c,o,p,e[r+11],14,643717713),p=I(p,u,c,o,e[r],20,-373897302),o=I(o,p,u,c,e[r+5],5,-701558691),c=I(c,o,p,u,e[r+10],9,38016083),u=I(u,c,o,p,e[r+15],14,-660478335),p=I(p,u,c,o,e[r+4],20,-405537848),o=I(o,p,u,c,e[r+9],5,568446438),c=I(c,o,p,u,e[r+14],9,-1019803690),u=I(u,c,o,p,e[r+3],14,-187363961),p=I(p,u,c,o,e[r+8],20,1163531501),o=I(o,p,u,c,e[r+13],5,-1444681467),c=I(c,o,p,u,e[r+2],9,-51403784),u=I(u,c,o,p,e[r+7],14,1735328473),p=I(p,u,c,o,e[r+12],20,-1926607734),o=A(o,p,u,c,e[r+5],4,-378558),c=A(c,o,p,u,e[r+8],11,-2022574463),u=A(u,c,o,p,e[r+11],16,1839030562),p=A(p,u,c,o,e[r+14],23,-35309556),o=A(o,p,u,c,e[r+1],4,-1530992060),c=A(c,o,p,u,e[r+4],11,1272893353),u=A(u,c,o,p,e[r+7],16,-155497632),p=A(p,u,c,o,e[r+10],23,-1094730640),o=A(o,p,u,c,e[r+13],4,681279174),c=A(c,o,p,u,e[r],11,-358537222),u=A(u,c,o,p,e[r+3],16,-722521979),p=A(p,u,c,o,e[r+6],23,76029189),o=A(o,p,u,c,e[r+9],4,-640364487),c=A(c,o,p,u,e[r+12],11,-421815835),u=A(u,c,o,p,e[r+15],16,530742520),p=A(p,u,c,o,e[r+2],23,-995338651),o=k(o,p,u,c,e[r],6,-198630844),c=k(c,o,p,u,e[r+7],10,1126891415),u=k(u,c,o,p,e[r+14],15,-1416354905),p=k(p,u,c,o,e[r+5],21,-57434055),o=k(o,p,u,c,e[r+12],6,1700485571),c=k(c,o,p,u,e[r+3],10,-1894986606),u=k(u,c,o,p,e[r+10],15,-1051523),p=k(p,u,c,o,e[r+1],21,-2054922799),o=k(o,p,u,c,e[r+8],6,1873313359),c=k(c,o,p,u,e[r+15],10,-30611744),u=k(u,c,o,p,e[r+6],15,-1560198380),p=k(p,u,c,o,e[r+13],21,1309151649),o=k(o,p,u,c,e[r+4],6,-145523070),c=k(c,o,p,u,e[r+11],10,-1120210379),u=k(u,c,o,p,e[r+2],15,718787259),p=k(p,u,c,o,e[r+9],21,-343485551),o=b(o,a),p=b(p,i),u=b(u,s),c=b(c,n);return[o,p,u,c]}(function(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)r[t>>5]|=(255&e[t/8])<<t%32;return r}(e),8*e.length))}));function j(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:return t^r^a;case 2:return t&r^t&a^r&a;case 3:return t^r^a}}function O(e,t){return e<<t|e>>>32-t}var q=v("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=new Array(a.length);for(var i=0;i<a.length;i++)e[i]=a.charCodeAt(i)}e.push(128);var s=e.length/4+2,n=Math.ceil(s/16),o=new Array(n);for(i=0;i<n;i++){o[i]=new Array(16);for(var p=0;p<16;p++)o[i][p]=e[64*i+4*p]<<24|e[64*i+4*p+1]<<16|e[64*i+4*p+2]<<8|e[64*i+4*p+3]}for(o[n-1][14]=8*(e.length-1)/Math.pow(2,32),o[n-1][14]=Math.floor(o[n-1][14]),o[n-1][15]=8*(e.length-1)&4294967295,i=0;i<n;i++){for(var u=new Array(80),c=0;c<16;c++)u[c]=o[i][c];for(c=16;c<80;c++)u[c]=O(u[c-3]^u[c-8]^u[c-14]^u[c-16],1);var d=r[0],y=r[1],h=r[2],m=r[3],f=r[4];for(c=0;c<80;c++){var l=Math.floor(c/20),g=O(d,5)+j(l,y,h,m)+f+t[l]+u[c]>>>0;f=m,m=h,h=O(y,30)>>>0,y=d,d=g}r[0]=r[0]+d>>>0,r[1]=r[1]+y>>>0,r[2]=r[2]+h>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+f>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),S=Object.freeze({__proto__:null,v1:function(e,t,r){var a=t&&r||0,i=t||[],s=(e=e||{}).node||d,n=void 0!==e.clockseq?e.clockseq:y;if(null==s||null==n){var o=e.random||(e.rng||c)();null==s&&(s=d=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==n&&(n=y=16383&(o[6]<<8|o[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:g+1,h=p-l+(u-g)/1e4;if(h<0&&void 0===e.clockseq&&(n=n+1&16383),(h<0||p>l)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=p,g=u,y=n;var m=(1e4*(268435455&(p+=122192928e5))+u)%4294967296;i[a++]=m>>>24&255,i[a++]=m>>>16&255,i[a++]=m>>>8&255,i[a++]=255&m;var v=p/4294967296*1e4&268435455;i[a++]=v>>>8&255,i[a++]=255&v,i[a++]=v>>>24&15|16,i[a++]=v>>>16&255,i[a++]=n>>>8|128,i[a++]=255&n;for(var b=0;b<6;++b)i[a+b]=s[b];return t||f(i)},v3:_,v4:function(e,t,r){var a=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||c)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[a+s]=i[s];return t||f(i)},v5:q}),U=M,T=M,E={$schema:"http://json-schema.org/draft-07/schema#",definitions:{User:{properties:{identities:{additionalProperties:{type:"string"},type:"object"},segments:{items:{type:"string"},type:"array"},traits:{additionalProperties:{},type:"object"}},required:["identities"],type:"object"}},properties:{action:{type:"string"},metadata:{additionalProperties:{anyOf:[{items:{},type:"array"},{type:["string","number","boolean"]}]},properties:{currency:{type:"string"},market:{type:"string"},orderId:{type:"string"},price:{type:"number"},quantity:{type:"number"}},type:"object"},opposite:{type:"boolean"},segments:{items:{type:"string"},type:"array"},sourceId:{type:"string"},target:{additionalProperties:{type:"string"},type:"object"},timestamp:{type:"string"},user:{$ref:"#/definitions/User"}},required:["action","target"],type:"object"},C={properties:{identities:{additionalProperties:{type:"string"},type:"object"},segments:{items:{type:"string"},type:"array"},traits:{additionalProperties:{},type:"object"}},required:["identities"],type:"object"};function M(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,i=0;if(e&&"object"==typeof e&&!Array.isArray(e)){if(void 0===e.action){var s={instancePath:r,schemaPath:"#/required",keyword:"required",params:{missingProperty:"action"},message:"must have required property 'action'",schema:E.required,parentSchema:E,data:e};null===a?a=[s]:a.push(s),i++}if(void 0===e.target){var n={instancePath:r,schemaPath:"#/required",keyword:"required",params:{missingProperty:"target"},message:"must have required property 'target'",schema:E.required,parentSchema:E,data:e};null===a?a=[n]:a.push(n),i++}if(void 0!==e.action){var o=e.action;if("string"!=typeof o){var p={instancePath:r+"/action",schemaPath:"#/properties/action/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.action.type,parentSchema:E.properties.action,data:o};null===a?a=[p]:a.push(p),i++}}if(void 0!==e.metadata){var u=e.metadata;if(u&&"object"==typeof u&&!Array.isArray(u)){for(var c in u)if("currency"!==c&&"market"!==c&&"orderId"!==c&&"price"!==c&&"quantity"!==c){var d=u[c],y=i,h=!1,m=i;if(!Array.isArray(d)){var f={instancePath:r+"/metadata/"+c.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf/0/type",keyword:"type",params:{type:"array"},message:"must be array",schema:E.properties.metadata.additionalProperties.anyOf[0].type,parentSchema:E.properties.metadata.additionalProperties.anyOf[0],data:d};null===a?a=[f]:a.push(f),i++}var l=m===i;if(!(h=h||l)){var g=i;if("string"!=typeof d&&("number"!=typeof d||!isFinite(d))&&"boolean"!=typeof d){var v={instancePath:r+"/metadata/"+c.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf/1/type",keyword:"type",params:{type:E.properties.metadata.additionalProperties.anyOf[1].type},message:"must be string,number,boolean",schema:E.properties.metadata.additionalProperties.anyOf[1].type,parentSchema:E.properties.metadata.additionalProperties.anyOf[1],data:d};null===a?a=[v]:a.push(v),i++}l=g===i;h=h||l}if(h)i=y,null!==a&&(y?a.length=y:a=null);else{var b={instancePath:r+"/metadata/"+c.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf",schema:E.properties.metadata.additionalProperties.anyOf,parentSchema:E.properties.metadata.additionalProperties,data:d};null===a?a=[b]:a.push(b),i++}}if(void 0!==u.currency){var P=u.currency;if("string"!=typeof P){var w={instancePath:r+"/metadata/currency",schemaPath:"#/properties/metadata/properties/currency/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.metadata.properties.currency.type,parentSchema:E.properties.metadata.properties.currency,data:P};null===a?a=[w]:a.push(w),i++}}if(void 0!==u.market){var I=u.market;if("string"!=typeof I){var A={instancePath:r+"/metadata/market",schemaPath:"#/properties/metadata/properties/market/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.metadata.properties.market.type,parentSchema:E.properties.metadata.properties.market,data:I};null===a?a=[A]:a.push(A),i++}}if(void 0!==u.orderId){var k=u.orderId;if("string"!=typeof k){var _={instancePath:r+"/metadata/orderId",schemaPath:"#/properties/metadata/properties/orderId/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.metadata.properties.orderId.type,parentSchema:E.properties.metadata.properties.orderId,data:k};null===a?a=[_]:a.push(_),i++}}if(void 0!==u.price){var j=u.price;if("number"!=typeof j||!isFinite(j)){var O={instancePath:r+"/metadata/price",schemaPath:"#/properties/metadata/properties/price/type",keyword:"type",params:{type:"number"},message:"must be number",schema:E.properties.metadata.properties.price.type,parentSchema:E.properties.metadata.properties.price,data:j};null===a?a=[O]:a.push(O),i++}}if(void 0!==u.quantity){var q=u.quantity;if("number"!=typeof q||!isFinite(q)){var S={instancePath:r+"/metadata/quantity",schemaPath:"#/properties/metadata/properties/quantity/type",keyword:"type",params:{type:"number"},message:"must be number",schema:E.properties.metadata.properties.quantity.type,parentSchema:E.properties.metadata.properties.quantity,data:q};null===a?a=[S]:a.push(S),i++}}}else{var U={instancePath:r+"/metadata",schemaPath:"#/properties/metadata/type",keyword:"type",params:{type:"object"},message:"must be object",schema:E.properties.metadata.type,parentSchema:E.properties.metadata,data:u};null===a?a=[U]:a.push(U),i++}}if(void 0!==e.opposite){var T=e.opposite;if("boolean"!=typeof T){var R={instancePath:r+"/opposite",schemaPath:"#/properties/opposite/type",keyword:"type",params:{type:"boolean"},message:"must be boolean",schema:E.properties.opposite.type,parentSchema:E.properties.opposite,data:T};null===a?a=[R]:a.push(R),i++}}if(void 0!==e.segments){var x=e.segments;if(Array.isArray(x))for(var D=x.length,z=0;z<D;z++){var V=x[z];if("string"!=typeof V){var L={instancePath:r+"/segments/"+z,schemaPath:"#/properties/segments/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.segments.items.type,parentSchema:E.properties.segments.items,data:V};null===a?a=[L]:a.push(L),i++}}else{var F={instancePath:r+"/segments",schemaPath:"#/properties/segments/type",keyword:"type",params:{type:"array"},message:"must be array",schema:E.properties.segments.type,parentSchema:E.properties.segments,data:x};null===a?a=[F]:a.push(F),i++}}if(void 0!==e.sourceId){var H=e.sourceId;if("string"!=typeof H){var N={instancePath:r+"/sourceId",schemaPath:"#/properties/sourceId/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.sourceId.type,parentSchema:E.properties.sourceId,data:H};null===a?a=[N]:a.push(N),i++}}if(void 0!==e.target){var B=e.target;if(B&&"object"==typeof B&&!Array.isArray(B))for(var G in B){var K=B[G];if("string"!=typeof K){var Q={instancePath:r+"/target/"+G.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/target/additionalProperties/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.target.additionalProperties.type,parentSchema:E.properties.target.additionalProperties,data:K};null===a?a=[Q]:a.push(Q),i++}}else{var $={instancePath:r+"/target",schemaPath:"#/properties/target/type",keyword:"type",params:{type:"object"},message:"must be object",schema:E.properties.target.type,parentSchema:E.properties.target,data:B};null===a?a=[$]:a.push($),i++}}if(void 0!==e.timestamp){var J=e.timestamp;if("string"!=typeof J){var X={instancePath:r+"/timestamp",schemaPath:"#/properties/timestamp/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.timestamp.type,parentSchema:E.properties.timestamp,data:J};null===a?a=[X]:a.push(X),i++}}if(void 0!==e.user){var W=e.user;if(W&&"object"==typeof W&&!Array.isArray(W)){if(void 0===W.identities){var Y={instancePath:r+"/user",schemaPath:"#/definitions/User/required",keyword:"required",params:{missingProperty:"identities"},message:"must have required property 'identities'",schema:C.required,parentSchema:C,data:W};null===a?a=[Y]:a.push(Y),i++}if(void 0!==W.identities){var Z=W.identities;if(Z&&"object"==typeof Z&&!Array.isArray(Z))for(var ee in Z){var te=Z[ee];if("string"!=typeof te){var re={instancePath:r+"/user/identities/"+ee.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/User/properties/identities/additionalProperties/type",keyword:"type",params:{type:"string"},message:"must be string",schema:C.properties.identities.additionalProperties.type,parentSchema:C.properties.identities.additionalProperties,data:te};null===a?a=[re]:a.push(re),i++}}else{var ae={instancePath:r+"/user/identities",schemaPath:"#/definitions/User/properties/identities/type",keyword:"type",params:{type:"object"},message:"must be object",schema:C.properties.identities.type,parentSchema:C.properties.identities,data:Z};null===a?a=[ae]:a.push(ae),i++}}if(void 0!==W.segments){var ie=W.segments;if(Array.isArray(ie))for(var se=ie.length,ne=0;ne<se;ne++){var oe=ie[ne];if("string"!=typeof oe){var pe={instancePath:r+"/user/segments/"+ne,schemaPath:"#/definitions/User/properties/segments/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:C.properties.segments.items.type,parentSchema:C.properties.segments.items,data:oe};null===a?a=[pe]:a.push(pe),i++}}else{var ue={instancePath:r+"/user/segments",schemaPath:"#/definitions/User/properties/segments/type",keyword:"type",params:{type:"array"},message:"must be array",schema:C.properties.segments.type,parentSchema:C.properties.segments,data:ie};null===a?a=[ue]:a.push(ue),i++}}if(void 0!==W.traits){var ce=W.traits;if(ce&&"object"==typeof ce&&!Array.isArray(ce));else{var de={instancePath:r+"/user/traits",schemaPath:"#/definitions/User/properties/traits/type",keyword:"type",params:{type:"object"},message:"must be object",schema:C.properties.traits.type,parentSchema:C.properties.traits,data:ce};null===a?a=[de]:a.push(de),i++}}}else{var ye={instancePath:r+"/user",schemaPath:"#/definitions/User/type",keyword:"type",params:{type:"object"},message:"must be object",schema:C.type,parentSchema:C,data:W};null===a?a=[ye]:a.push(ye),i++}}}else{var he={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:E.type,parentSchema:E,data:e};null===a?a=[he]:a.push(he),i++}return M.errors=a,0===i}U.default=T;var R,x=(R=S)&&R.default||R,D=a((function(e,r){var a=t&&t.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,o=i(U),p=function(){function e(){this.isInitialized=!1,this.sample={action:"",target:{}},this.user={identities:{},segments:[],traits:{}}}return e.prototype.initUser=function(e){this.user.identities.sessionid||(this.user.identities.sessionid=e.getItem("attraqtsessionid")||x.v4()),this.storage.setItem("attraqtsessionid",this.user.identities.sessionid)},e.prototype.assertIsInit=function(){if(!this.isInitialized)throw Error("The activities module must be initialized before using methods.")},e.prototype.init=function(e,t){var r;if(!e||!e.trackerKey)throw Error("A tracker key is required to initialize the activities module.");var a=(null===(r=e.region)||void 0===r?void 0:r.toLowerCase())||s.EU;this.apiUrl="http"+(a!==s.DEV?"s":"")+"://collect-"+a+".attraqt.io/"+e.trackerKey,this.storage=e.storage,this.httpClient=t,this.initUser(this.storage),this.hasOptedOut="true"===this.storage.getItem("attraqtoptout"),this.isInitialized=!0},e.prototype.send=function(e,t){var r=this;if(!this.isInitialized)throw Error("The activities module must be initialized before sending activities.");var i=[].concat(e).map((function(e){var t=a(a({},e),{user:e&&e.user?e.user:r.user});if(!o.default(t))throw new Error("The provided activity does not match the required format.");return t}));if(this.hasOptedOut)return null;var s=a({method:n.Method.Post,headers:{"Content-Type":"application/json"},url:this.apiUrl,body:JSON.stringify(i)},t);return this.httpClient.send(s)},e.prototype.setUser=function(e){if(this.assertIsInit(),!e||!o.default(a(a({},this.sample),{user:e})))throw new TypeError("The provided user does not match the required format.");this.setUserIdentities(e.identities),this.setUserSegments(e.segments),this.setUserTraits(e.traits),this.initUser(this.storage)},e.prototype.addUserIdentity=function(e,t){if(this.assertIsInit(),"string"!=typeof e||"string"!=typeof t)throw new TypeError("identityRepository and identity must be strings.");this.user.identities[e.toLocaleLowerCase()]=t,this.initUser(this.storage)},e.prototype.setUserIdentities=function(e){if(this.assertIsInit(),!o.default(a(a({},this.sample),{user:{identities:e}}))||0===Object.keys(e).length)throw new TypeError("The provided identities do not match the required format.");this.user.identities=e,this.initUser(this.storage)},e.prototype.addUserSegment=function(e){if(this.assertIsInit(),"string"!=typeof e)throw new TypeError("segment must be a string.");this.user.segments.push(e)},e.prototype.setUserSegments=function(e){if(this.assertIsInit(),!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw new TypeError("segments must be an array of strings.");this.user.segments=e},e.prototype.addUserTrait=function(e,t){if(this.assertIsInit(),"string"!=typeof e||"string"!=typeof t)throw new TypeError("trait and traitValue must be strings.");this.user.traits[e]=t},e.prototype.setUserTraits=function(e){if(this.assertIsInit(),!o.default(a(a({},this.sample),{user:{identities:{},traits:e}})))throw new TypeError("The provided traits do not match the required format.");this.user.traits=e},e.prototype.clearUser=function(){this.assertIsInit(),this.user={identities:{},segments:[],traits:{}},this.storage.removeItem("attraqtsessionid"),this.initUser(this.storage)},e.prototype.optOut=function(){this.assertIsInit(),this.hasOptedOut=!0,this.storage.setItem("attraqtoptout","true")},e.prototype.optIn=function(){this.assertIsInit(),this.hasOptedOut=!1,this.storage.removeItem("attraqtoptout")},e}();r.Activity=p,function(e){e.DEV="dev",e.EU="eu",e.AP1="ap1",e.AP2="ap2"}(s=r.Region||(r.Region={}))}));r(D);D.Activity,D.Region;var z=a((function(e,r){var a,i=t&&t.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.init=function(t,r){void 0===r&&(r=new o.BrowserHttpClient(window)),t.storage||(t.storage=window.localStorage),e.prototype.init.call(this,t,r)},t.prototype.send=function(t,r){return"1"===navigator.doNotTrack?null:e.prototype.send.call(this,t,r)},t.prototype.handleQueuedEvents=function(){var e=this;[].concat(window._attraqt).filter((function(e){return Array.isArray(e)})).forEach((function(t){var r;(r=e)[t[0]].apply(r,t.filter((function(e){return e})).slice(1))})),window._attraqt=[]},t}(D.Activity);r.Activity=s,r.activity=new s,r.init=function(e){r.activity.init(e.activity)},r.activity.handleQueuedEvents()})),V=r(z),L=z.Activity,F=z.activity,H=z.init;return e.Activity=L,e.activity=F,e.default=V,e.init=H,e}({});
